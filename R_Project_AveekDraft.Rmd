---
title: "R_PROJECT"
author: "AVEEK DAS"
date: "12/6/2020"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# {.tabset}
## Introduction 

This project aims to analyze road accident casualties in Ireland from 2005-2018. The analysis will include a variety of comparisons between different kinds of road users, of a range of age groups, across both genders.

__Objective:__ The goal of this project is to determine trends in casualty rates of different cohorts, produce graphical explanations for these trends and ultimately through predictive analysis, determine what directions these trends seem to be heading towards in the future. 

## Cleaning
```{r}
# Understanding the Road User Type based on Age Group and Gender
library(pxR)
library(ggplot2)
library(tidyverse)
df = as.data.frame(read.px("ROA16.px"))
names(df)<-c("Statistic","Year","Road.User.Type","Sex","Age.Group","value")
head(df)

#check for na's
sapply(df, function(x) which(is.na(x)))

# Filter all the redundant data

df <- df %>%
  filter(df$Statistic != "All Killed and Injured Casualties (Number)"&df$Road.User.Type != "All road users"&df$Road.User.Type != "All Car users"&df$Age.Group != 'All ages')

sum(df$value) #112279
```

## Visual analysis {.tabset}

### Age analysis



```{r}
library(ggplot2)
ggplot(data=df, aes(x=Age.Group, y=value, fill=Statistic), position = "fill") +
  geom_bar(stat="identity") +
  coord_flip()

ggplot(data=df, aes(x=Age.Group, y=value, fill=Road.User.Type), position = "fill") +
  geom_bar(stat="identity") +
  coord_flip()
```

We can see from the first plot the 25-34 year olds are by far the highest category in terms of casualties in this dataset. Here we are going to look deeper into the younger casualties on Irish roads.
```{r}
library(ggplot2)

 s4<- df[df$Statistic=='Injured Cassualties (Number)' & (df$Road.User.Type == 'Car drivers' | df$Road.User.Type=='Motor cyclists'| df$Road.User.Type=='Pedal cyclists') & (df$Age.Group == '15 - 17 years' | df$Age.Group == '18 - 20 years' | df$Age.Group == '21 - 24 years' | df$Age.Group == '25 - 34 years'),]
ggplot(s4, aes(x=Road.User.Type,y=value, fill=Road.User.Type)) +
  geom_col() +
  ggtitle("Younger casualties") +
  scale_fill_manual(values = c("#8489EF", "#E7B800", "#AC1E07")) + 
  facet_wrap(~Age.Group,scale="free_y")

w<-df[df$Age.Group=='15 - 17 years',]
w1<-df[df$Age.Group=='18 - 20 years',]
w2<-df[df$Age.Group=='21 - 24 years',]
sum(c(w$Value,w1$Value,w2$Value))
w3<-df[df$Age.Group=='24 - 34 years',]
w4<-df[df$Age.Group=='35 - 44 years',]
w5<-df[df$Age.Group=='45 - 54 years',]
w6<-df[df$Age.Group=='55 - 64 years',]
w7<-df[df$Age.Group=='65 years and over',]
sum(c(w$value,w1$value,w2$value,w3$value,w4$value,w5$value,w6$value,w7$value))
```

According to the RSA online data revealing drivers licences numbers held by Irish drivers (https://data.cso.ie/) in 2018 there were 233187 drivers ages 17-24 on our roads. From the Casualties data we can calculate that the percentage of these drivers to be recorded killed or injured is: 27204/233187 = 0.1166617 where as when we take the total for the whole population and compare it we get : 76347/2907193 = 0.02626141. So when we compare the younger drivers to the overall population there is a 9% increase in casualties when comapared to the total amount of drivers on the roads.

Lets now look at the 24-35 year olds deeper.
```{r}
library(ggplot2)
library(gridExtra)
library(viridis)

sub6<- df[df$Age.Group == '25 - 34 years',]
p17<-ggplot(data=sub6, aes(x=Age.Group, y=value, fill=Road.User.Type), position = "fill") +
  geom_bar(stat="identity") +
  ggtitle("24-35 year old total casualty rates by Road User Type") +
  scale_color_viridis(option = "D") +
  theme_minimal()

p18<-ggplot(data=sub6, aes(x=Age.Group, y=value, fill=Road.User.Type), position = "fill") +
  geom_bar(stat="identity",position=position_dodge()) +
  scale_color_viridis(option = "D") +
  theme_minimal() +
  theme(legend.position = "none")

grid.arrange(p17,p18,layout_matrix = rbind(c(1, 2)))
```

We further breakdown the 25-34 year olds

```{r}
library(ggplot2)

sub6<- df[df$Age.Group == '25 - 34 years',]


hcols<- c('Pedestrians'="#FFDEDA", 'Pedal cyclists'="#9B94BE",'Motor cyclists'="#F9C8A0",'Car drivers'="#F28997",'Car passengers'="#C1E3FE",'Other road users'= "#FDB4C1")
pi1<-ggplot(data=sub6) +
  geom_col(aes(x=1, y=value, fill=Road.User.Type), position = "fill") +
  coord_polar(theta = "y") +
  scale_fill_manual(values = hcols) +
  ggtitle("24-35 year old casualty rates") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        legend.title = element_text(size = 8)) +
  facet_wrap(~ Sex)

pi2<-ggplot(data=df) +
  geom_col(aes(x=1, y=value, fill=Road.User.Type), position = "fill") +
  coord_polar(theta = "y") +
  scale_fill_manual(values = hcols) +
  ggtitle("Total population") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        legend.title = element_text(size = 8)) +
  facet_wrap(~ Sex)

grid.arrange(pi1,pi2,layout_matrix = rbind(c(1, 1),c(2,2)))

```


Interestingly when we look into the gender differences between the 25-34 year olds, from the pie charts it is noticable that females have a much bigger proportion of Car drivers  involved in accidents than males as well as being the larger portion of the injured car passengers also. It is noticable the wedge difference between male and female motor cyclists, a very small wedge for the females and for the males it is there 3rd or 4th largest wedge. 

We see from the linear model below that an increase in female drivers by one it would result in a decrease in Value by 17.96, when taking into account Car drivers, passengers and motor cyclists. The p-value for SexFemale > 0.05 though so we remove this variable as it isnt statistcally strong enough for the model. The second linear model says that an increase in passengers and drivers on the road would results in greater casualty values.
```{r}
sub7<- df[(df$Road.User.Type=='Car drivers'| df$Road.User.Type=='Car passengers' | df$Road.User.Type=='Motor cyclists') & df$Age.Group == '25 - 34 years',]

f<-lm(value~Statistic+Road.User.Type+Sex, data=sub7) 
summary(f) #Sex pvalue >0.05 so..
f<-lm(value~Statistic+Road.User.Type, data=sub7) 
summary(f)

```

### Further analysis

```{r}
p<-ggplot(data=df, aes(x=Road.User.Type, y=value)) +
  geom_bar(stat="identity") +
  coord_flip()
p
```


```{r}

ggplot(data=df, aes(x=Road.User.Type, y=value, fill=Statistic), position = "fill") +
  geom_bar(stat="identity") +
  coord_flip()
```

From the above, we can conclude that the Car Drivers having the highest Casualties Count.

Driving Casualities by Gender per Year

```{r}
df.female = df[df$Sex == 'Female',]
sum.female <- aggregate(value~Year, df.female, sum)

df.female.car_drivers = df[df$Road.User.Type == "Car drivers" & df$Sex == 'Female',]
sum.female.car_drivers <- aggregate(value~Year, df.female.car_drivers, sum)

prop.female = round(sum.female.car_drivers$value/sum.female$value, 2)
prop.female





df.male = df[df$Sex == 'Male', ]
sum.male <- aggregate(value~Year, df.male, sum)

df.male.car_drivers = df[df$Road.User.Type == "Car drivers" & df$Sex == 'Male', ]
sum.male.car_drivers <- aggregate(value~Year, df.male.car_drivers, sum)

prop.male = round(sum.male.car_drivers$value/sum.male$value, 2)
prop.male
```


Proportion of Male and Female Car Driving Death Casualties Trend over 14 years.

```{r}
df.killed.female.car_drivers = df[df$Statistic =='Killed Casualties (Number)' & df$Road.User.Type == "Car drivers" & df$Sex == 'Female', ]
sum.killed.female.car_drivers <- aggregate(value~Year, df.killed.female.car_drivers, sum)

df.female.car_drivers = df[df$Road.User.Type == "Car drivers" & df$Sex == 'Female', ]
sum.female.car_drivers <- aggregate(value~Year, df.female.car_drivers, sum)

killed.female.prop = round(sum.killed.female.car_drivers$value/sum.female.car_drivers$value, 2)
killed.female.prop




df.killed.male.car_drivers = df[df$Statistic =='Killed Casualties (Number)' & df$Road.User.Type == "Car drivers" & df$Sex == 'Male', ]
sum.killed.male.car_drivers <- aggregate(value~Year, df.killed.male.car_drivers, sum)

df.male.car_drivers = df[df$Road.User.Type == "Car drivers" & df$Sex == 'Male', ]
sum.male.car_drivers <- aggregate(value~Year, df.male.car_drivers, sum)
killed.male.prop = round(sum.killed.male.car_drivers$value/sum.male.car_drivers$value, 2)
killed.male.prop
```

Categorical Count of AGe Group WIse Casualties for 14 years.

```{r}
ggplot(data=df, aes(x=Age.Group, y=value, fill=Statistic), position = "fill") +
  geom_bar(stat="identity")
```


The age group containing 25-34 years has the highest number of casualities.

From the above we can conclude that the Road User Type of Pedal Cyclist has an increasing trend of casualties over the years. However, the proportions of fatalities is minimum.
